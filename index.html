<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Rekap Kebakaran</title>

<style>
body{
  font-family:Segoe UI,Arial;
  background:#0f1115;
  color:#eaeaea;
  margin:20px;
}
h1{color:#ff6b6b}

.filter{margin-bottom:12px}
select{
  padding:6px 10px;
  border-radius:8px;
  background:#161a24;
  color:#fff;
  border:1px solid #2a2e3b;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
th,td{
  border:1px solid #2a2e3b;
  padding:6px;
}
th{
  background:#1c2130;
  color:#ffb3b3;
}
tr:nth-child(even){background:#141824}
</style>
</head>

<body>

<h1>ðŸ”¥ Dashboard Rekap Kebakaran</h1>

<div class="filter">
  Filter Bulan :
  <select id="bulan">
    <option value="all">Semua Bulan</option>
    <option value="01">Januari</option>
    <option value="02">Februari</option>
    <option value="03">Maret</option>
    <option value="04">April</option>
    <option value="05">Mei</option>
    <option value="06">Juni</option>
    <option value="07">Juli</option>
    <option value="08">Agustus</option>
    <option value="09">September</option>
    <option value="10">Oktober</option>
    <option value="11">November</option>
    <option value="12">Desember</option>
  </select>
</div>

<table>
<thead>
<tr>
  <th>Tanggal</th>
  <th>Waktu</th>
  <th>Jenis</th>
  <th>Alamat</th>
  <th>Kelurahan</th>
  <th>Kecamatan</th>
  <th>Kota</th>
  <th>Objek</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
/* =======================
   WAJIB DIISI
======================= */
const API_KEY = "AIzaSyAvQLFQUfTAovJ-J3_WYvh7KuzQqnkdx4M";
const SPREADSHEET_ID = "1PU8hf7BEu142XSi0QjCMDgPsD6KaSFET";

/* ======================= */

const tbody = document.getElementById("tbody");
const filterBulan = document.getElementById("bulan");

/* default bulan berjalan */
filterBulan.value = String(new Date().getMonth()+1).padStart(2,"0");
filterBulan.addEventListener("change", render);

/* daftar sheet (TAB) */
const SHEETS = [
  "Januari","Februari","Maret","April","Mei","Juni",
  "Juli","Agustus","September","Oktober","November","Desember"
];

let semuaData = [];

/* AMBIL SEMUA SHEET */
Promise.all(
  SHEETS.map(nama =>
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${nama}?key=${API_KEY}`)
      .then(r => r.json())
      .then(d => d.values ? d.values.slice(1) : [])
      .catch(()=>[])
  )
).then(data=>{
  semuaData = data.flat();
  render();
});

/* DETEKSI BULAN ANGKA & HURUF */
function getBulan(val){
  if(!val) return "";
  val = val.toString().toLowerCase();

  const map={
    januari:"01", jan:"01",
    februari:"02", feb:"02",
    maret:"03", mar:"03",
    april:"04", apr:"04",
    mei:"05",
    juni:"06", jun:"06",
    juli:"07", jul:"07",
    agustus:"08", agu:"08", aug:"08",
    september:"09", sep:"09",
    oktober:"10", okt:"10",
    november:"11", nov:"11",
    desember:"12", des:"12"
  };

  for(const k in map){
    if(val.includes(k)) return map[k];
  }

  if(val.includes("/")) return val.split("/")[1]?.padStart(2,"0") || "";
  if(val.includes("-")) return val.split("-")[1] || "";

  return "";
}

function render(){
  tbody.innerHTML="";
  const bulanDipilih = filterBulan.value;

  semuaData.forEach(r=>{
    const tanggal = r[0] || "";
    const bulan = getBulan(tanggal);

    if(bulanDipilih!=="all" && bulan!==bulanDipilih) return;

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${tanggal}</td>
      <td>${r[1]||""}</td>
      <td>${r[2]||""}</td>
      <td>${r[3]||""}</td>
      <td>${r[4]||""}</td>
      <td>${r[5]||""}</td>
      <td>${r[6]||""}</td>
      <td>${r[7]||""}</td>
    `;
    tbody.appendChild(tr);
  });
}
</script>

</body>
</html>
