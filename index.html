<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Command Center Kebencanaan</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
:root{
  --bg:#0b0e14;
  --panel:#111726;
  --text:#eaeaea;
  --danger:#ff3d3d;
}
html,body{
  margin:0;height:100%;overflow:hidden;
  background:var(--bg);color:var(--text);
  font-family:Segoe UI,Arial,sans-serif;
}

/* ===== DASHBOARD KEBAKARAN ===== */
.topbar{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:6px;
  padding:6px;
}
.fire{
  border-radius:14px;
  padding:12px;
  text-align:center;
  font-weight:900;
  font-size:14px;
}
.fire span{display:block;font-size:30px}
.jb{background:#ff5252}
.jp{background:#ff9800;color:#111}
.js{background:#7c4dff}
.jt{background:#29b6f6;color:#111}
.ju{background:#26a69a}
.total{background:#b71c1c}

/* ===== VIDEOWALL ===== */
.wall{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  grid-template-rows:repeat(2,1fr);
  gap:6px;
  padding:6px;
  height:calc(100vh - 92px);
}
.panel{
  background:var(--panel);
  border-radius:14px;
  overflow:hidden;
  position:relative;
}
.title{
  position:absolute;
  top:0;left:0;right:0;
  padding:6px 10px;
  font-weight:700;
  font-size:14px;
  background:rgba(0,0,0,.6);
  z-index:5;
}
.focus{
  grid-column:1/span 3;
  grid-row:1/span 2;
}

/* ===== GEMPA ===== */
#autoGempa{
  padding:40px 20px;
  font-size:18px;
}
.mag{
  font-size:48px;
  font-weight:900;
}
.danger{color:var(--danger)}

#glist{
  padding:40px 14px 14px;
  font-size:14px;
}
.gitem{
  border-bottom:1px solid #333;
  padding:6px 0;
}

iframe{width:100%;height:100%;border:0}
</style>
</head>

<body>

<!-- ===== DASHBOARD KEBAKARAN ===== -->
<div class="topbar">
  <div class="fire jb">JAKARTA BARAT<span id="jb">0</span></div>
  <div class="fire jp">JAKARTA PUSAT<span id="jp">0</span></div>
  <div class="fire js">JAKARTA SELATAN<span id="js">0</span></div>
  <div class="fire jt">JAKARTA TIMUR<span id="jt">0</span></div>
  <div class="fire ju">JAKARTA UTARA<span id="ju">0</span></div>
  <div class="fire total">TOTAL<span id="total">0</span></div>
</div>

<!-- ===== VIDEOWALL ===== -->
<div class="wall">

  <div class="panel focus">
    <div class="title">üåç GEMPA TERKINI (XML BMKG)</div>
    <div id="autoGempa">Memuat...</div>
  </div>

  <div class="panel">
    <div class="title">üìç GEMPA DIRASAKAN</div>
    <div id="glist">Memuat...</div>
  </div>

  <div class="panel">
    <div class="title">üåä POSKO BANJIR DKI</div>
    <iframe id="banjir"></iframe>
  </div>

  <div class="panel">
    <div class="title">üåã MAGMA ESDM</div>
    <iframe id="magma"></iframe>
  </div>

  <div class="panel">
    <div class="title">üî• SIPONGI KARHUTLA</div>
    <iframe id="sipongi"></iframe>
  </div>

  <div class="panel">
    <div class="title">‚ÑπÔ∏è MONITOR</div>
  </div>

</div>

<!-- ===== ALARM ===== -->
<audio id="alarm">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<script>
/* ===== AUTO GEMPA XML ===== */
let lastGempa="";

function loadAutoGempa(){
 fetch("https://data.bmkg.go.id/DataMKG/TEWS/autogempa.xml?"+Date.now())
 .then(r=>r.text())
 .then(xmlText=>{
  const xml=new DOMParser().parseFromString(xmlText,"text/xml");
  const g=xml.querySelector("gempa");
  const mag=parseFloat(g.querySelector("Magnitude").textContent);
  const wilayah=g.querySelector("Wilayah").textContent;
  const waktu=g.querySelector("Tanggal").textContent+" "+g.querySelector("Jam").textContent;
  const kedalaman=g.querySelector("Kedalaman").textContent;
  const potensi=g.querySelector("Potensi").textContent;
  const shakemap=g.querySelector("Shakemap").textContent;
  const id=waktu+mag;

  if(mag>=5 && id!==lastGempa){
    document.getElementById("alarm").play();
    lastGempa=id;
  }

  autoGempa.innerHTML=`
   <div class="mag ${mag>=5?'danger':''}">${mag} M</div>
   <div>${wilayah}</div>
   <div>Kedalaman: ${kedalaman}</div>
   <div>${waktu}</div>
   <div>${potensi}</div>
   <img src="https://static.bmkg.go.id/${shakemap}"
        style="width:100%;max-height:240px;object-fit:contain">
  `;
 });
}
loadAutoGempa();
setInterval(loadAutoGempa,15000);

/* ===== GEMPA DIRASAKAN ===== */
function loadDirasakan(){
 fetch("https://data.bmkg.go.id/DataMKG/TEWS/gempadirasakan.xml?"+Date.now())
 .then(r=>r.text())
 .then(xmlText=>{
  const xml=new DOMParser().parseFromString(xmlText,"text/xml");
  const list=xml.querySelectorAll("gempa");
  glist.innerHTML="";
  [...list].slice(0,10).forEach(g=>{
    glist.innerHTML+=`
     <div class="gitem">
      <strong>${g.querySelector("Magnitude").textContent} M</strong>
      ‚Äì ${g.querySelector("Wilayah").textContent}<br>
      <small>${g.querySelector("Dirasakan").textContent}</small>
     </div>`;
  });
 });
}
loadDirasakan();
setInterval(loadDirasakan,30000);

/* ===== KEBAKARAN ===== */
const CSVs=[
 "https://docs.google.com/spreadsheets/d/e/2PACX-1vS4JZD0cxRHeBcSJm0KZMXewwX19RWJL1GrNcn2ZQeyeQpVByaiIyt0_FCPEcaRMA/pub?output=csv&gid=1241106342",
 "https://docs.google.com/spreadsheets/d/e/2PACX-1vS4JZD0cxRHeBcSJm0KZMXewwX19RWJL1GrNcn2ZQeyeQpVByaiIyt0_FCPEcaRMA/pub?output=csv&gid=1284284298"
];
function loadKebakaran(){
 let c={jb:0,jp:0,js:0,jt:0,ju:0,total:0};
 Promise.all(CSVs.map(u=>new Promise(res=>{
  Papa.parse(u,{download:true,skipEmptyLines:true,complete:r=>res(r.data)});
 }))).then(all=>{
  all.flat().slice(1).forEach(r=>{
    if(!(r[3]||"").toLowerCase().includes("kebakaran"))return;
    const k=(r[7]||"").toLowerCase();
    c.total++;
    if(k.includes("barat"))c.jb++;
    else if(k.includes("pusat"))c.jp++;
    else if(k.includes("selatan"))c.js++;
    else if(k.includes("timur"))c.jt++;
    else if(k.includes("utara"))c.ju++;
  });
  jb.innerText=c.jb; jp.innerText=c.jp; js.innerText=c.js;
  jt.innerText=c.jt; ju.innerText=c.ju; total.innerText=c.total;
 });
}
loadKebakaran();
setInterval(loadKebakaran,180000);

/* ===== IFRAME REFRESH ===== */
function reload(id,url){
 document.getElementById(id).src=url+"?t="+Date.now();
}
reload("banjir","https://poskobanjir.dsdadki.web.id/");
reload("magma","https://magma.vsi.esdm.go.id/");
reload("sipongi","https://sipongi.gakkum.kehutanan.go.id/peta");
</script>

</body>
</html>
