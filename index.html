<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Rekap Kebakaran</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:Segoe UI,Arial;
  background:#0f1115;
  color:#eaeaea;
  margin:20px;
}
h1{color:#ff6b6b}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
  gap:14px;
  margin-bottom:20px;
}
.card{
  background:#161a24;
  border-radius:14px;
  padding:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.45);
}
.card h2{margin:0;font-size:14px;color:#aaa}
.card .count{font-size:40px;font-weight:800}

table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
th,td{
  border:1px solid #2a2e3b;
  padding:6px;
}
th{
  background:#1c2130;
  color:#ffb3b3;
}
tr:nth-child(even){background:#141824}

#filterContainer{
  margin-bottom:10px;
}
</style>
</head>

<body>

<h1>ðŸ”¥ Dashboard Rekap Kebakaran</h1>

<div id="filterContainer">
  Filter Bulan:
  <select id="monthFilter">
    <option value="all">Semua Bulan</option>
    <option value="01">Januari</option>
    <option value="02">Februari</option>
    <option value="03">Maret</option>
    <option value="04">April</option>
    <option value="05">Mei</option>
    <option value="06">Juni</option>
    <option value="07">Juli</option>
    <option value="08">Agustus</option>
    <option value="09">September</option>
    <option value="10">Oktober</option>
    <option value="11">November</option>
    <option value="12">Desember</option>
  </select>
</div>

<div class="dashboard">
  <div class="card"><h2>Jakarta Barat</h2><div class="count" id="jb">0</div></div>
  <div class="card"><h2>Jakarta Pusat</h2><div class="count" id="jp">0</div></div>
  <div class="card"><h2>Jakarta Selatan</h2><div class="count" id="js">0</div></div>
  <div class="card"><h2>Jakarta Timur</h2><div class="count" id="jt">0</div></div>
  <div class="card"><h2>Jakarta Utara</h2><div class="count" id="ju">0</div></div>
  <div class="card"><h2>Kep. Seribu</h2><div class="count" id="ks">0</div></div>
  <div class="card"><h2>Total</h2><div class="count" id="total">0</div></div>
</div>

<canvas id="chartKorban" height="100"></canvas>

<table>
<thead>
<tr>
  <th>Hari / Tanggal</th>
  <th>Waktu</th>
  <th>Jenis</th>
  <th>Alamat</th>
  <th>Kelurahan</th>
  <th>Kecamatan</th>
  <th>Kota</th>
  <th>Objek</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vS4JZD0cxRHeBcSJm0KZMXewwX19RWJL1GrNcn2ZQeyeQpVByaiIyt0_FCPEcaRMA/pub?output=csv";

let allRows = [];
const tbody = document.getElementById("tbody");
const monthFilter = document.getElementById("monthFilter");

Papa.parse(CSV_URL,{
  download:true,
  skipEmptyLines:true,
  complete:function(res){
    allRows = res.data;
    render();
  }
});

monthFilter.addEventListener("change", render);

function render(){
  const selectedMonth = monthFilter.value;
  tbody.innerHTML = "";

  let count={
    "Jakarta Barat":0,
    "Jakarta Pusat":0,
    "Jakarta Selatan":0,
    "Jakarta Timur":0,
    "Jakarta Utara":0,
    "Kepulauan Seribu":0
  };

  let unik={};
  let korbanPerKota={...count}; // misal untuk korban/pengungsi

  allRows.slice(1).forEach(r=>{
    const jenis = (r[3] || "").toLowerCase();
    if(!jenis.includes("kebakaran")) return;

    const hari = r[1] || "";
    const waktu = r[2] || "";
    const alamat = r[4] || "";
    const kel = r[5] || "";
    const kec = r[6] || "";
    const kota = r[7] || "";
    const objek = r[8] || "";

    // filter bulan
    const bulan = hari.split("/")[1] || "";
    if(selectedMonth !== "all" && bulan !== selectedMonth) return;

    const key = hari + alamat + kota;
    if(unik[key]) return;
    unik[key]=1;

    if(count[kota] !== undefined) count[kota]++;
    if(korbanPerKota[kota] !== undefined) korbanPerKota[kota] += Math.floor(Math.random()*5); // contoh data korban acak

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${hari}</td>
      <td>${waktu}</td>
      <td>KEBAKARAN</td>
      <td>${alamat}</td>
      <td>${kel}</td>
      <td>${kec}</td>
      <td>${kota}</td>
      <td>${objek}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("jb").innerText=count["Jakarta Barat"];
  document.getElementById("jp").innerText=count["Jakarta Pusat"];
  document.getElementById("js").innerText=count["Jakarta Selatan"];
  document.getElementById("jt").innerText=count["Jakarta Timur"];
  document.getElementById("ju").innerText=count["Jakarta Utara"];
  document.getElementById("ks").innerText=count["Kepulauan Seribu"];
  document.getElementById("total").innerText=
    Object.values(count).reduce((a,b)=>a+b,0);

  // Chart rekap korban/pengungsi
  const ctx = document.getElementById('chartKorban').getContext('2d');
  if(window.myChart) window.myChart.destroy();
  window.myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(korbanPerKota),
      datasets: [{
        label: 'Korban / Pengungsi',
        data: Object.values(korbanPerKota),
        backgroundColor: 'rgba(255, 99, 132, 0.7)'
      }]
    },
    options: {
      responsive:true,
      plugins:{
        legend:{display:false},
        title:{
          display:true,
          text:'Rekap Korban / Pengungsi per Kota'
        }
      },
      scales:{
        y:{beginAtZero:true}
      }
    }
  });
}
</script>

</body>
</html>
