<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Rekap Kebakaran per Wilayah</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{font-family:Segoe UI,Arial;background:#0f1115;color:#eee;margin:20px}
h1{color:#ff6b6b}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px}
.card{background:#161a24;border-radius:14px;padding:16px;text-align:center}
.count{font-size:42px;font-weight:800}
</style>
</head>

<body>

<h1>ðŸ”¥ Rekap Kebakaran per Wilayah</h1>

<div class="grid">
  <div class="card"><div>Jakarta Barat</div><div class="count" id="Jakarta Barat">0</div></div>
  <div class="card"><div>Jakarta Pusat</div><div class="count" id="Jakarta Pusat">0</div></div>
  <div class="card"><div>Jakarta Selatan</div><div class="count" id="Jakarta Selatan">0</div></div>
  <div class="card"><div>Jakarta Timur</div><div class="count" id="Jakarta Timur">0</div></div>
  <div class="card"><div>Jakarta Utara</div><div class="count" id="Jakarta Utara">0</div></div>
  <div class="card"><div>Kepulauan Seribu</div><div class="count" id="Kepulauan Seribu">0</div></div>
  <div class="card"><div>TOTAL</div><div class="count" id="TOTAL">0</div></div>
</div>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vS4JZD0cxRHeBcSJm0KZMXewwX19RWJL1GrNcn2ZQeyeQpVByaiIyt0_FCPEcaRMA/pub?output=csv";

Papa.parse(CSV_URL,{
  download:true,
  skipEmptyLines:true,
  complete:(res)=>proses(res.data)
});

function normal(v){return (v||"").toString().trim().toLowerCase()}

function proses(rows){
  let headerMap={}
  const count={
    "jakarta barat":0,
    "jakarta pusat":0,
    "jakarta selatan":0,
    "jakarta timur":0,
    "jakarta utara":0,
    "kepulauan seribu":0
  };

  rows.forEach(row=>{
    // detect header ulang
    row.forEach((c,i)=>{
      const v=normal(c)
      if(v.includes("jenis")) headerMap.jenis=i
      if(v.includes("kota")||v.includes("wilayah")) headerMap.kota=i
    });

    if(headerMap.jenis==null || headerMap.kota==null) return;

    const jenis=normal(row[headerMap.jenis]);
    if(!jenis.includes("kebakaran")) return;

    const kota=normal(row[headerMap.kota]);
    if(count[kota]!==undefined){
      count[kota]++;
    }
  });

  let total=0;
  Object.keys(count).forEach(k=>{
    document.getElementById(
      k.replace(/\b\w/g,l=>l.toUpperCase())
    ).innerText=count[k];
    total+=count[k];
  });

  document.getElementById("TOTAL").innerText=total;
}
</script>

</body>
</html>
