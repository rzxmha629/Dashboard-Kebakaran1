<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard Bencana DKI</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:#0f1115;
  color:#eaeaea;
}
header{
  padding:16px;
  background:#141824;
  box-shadow:0 6px 20px rgba(0,0,0,.4);
}
h1{margin:0;color:#ff6b6b}
p{margin:6px 0 0;color:#aaa}

.section{
  margin:18px;
  background:#161a24;
  border-radius:16px;
  padding:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.45);
}
h2{color:#6bcfff;margin:0 0 10px}

.alert{
  padding:14px;
  border-radius:14px;
  margin-bottom:10px;
}
.red{background:#b00020}
.orange{background:#f9a825;color:#111}
.green{background:#2e7d32}

iframe{
  width:100%;
  height:480px;
  border:none;
  border-radius:12px;
}
</style>
</head>

<body>

<header>
  <h1>ðŸŒŠ Dashboard Kebencanaan DKI</h1>
  <p>BMKG CAP â€¢ TMA â€¢ Auto-refresh</p>
</header>

<!-- ALERT BMKG -->
<div class="section">
  <h2>ðŸš¨ Peringatan Dini BMKG (CAP)</h2>
  <div id="bmkgAlert">Memuat data...</div>
</div>

<!-- TMA -->
<div class="section">
  <h2>ðŸŒŠ Tinggi Muka Air DKI</h2>
  <iframe src="https://pantaubanjir.jakarta.go.id/peta-informasi-banjir"></iframe>
</div>

<script>
// ============================
// BMKG CAP ALERT (XML)
// ============================
const BMKG_CAP =
  "https://www.bmkg.go.id/alerts/nowcast/id";

const CORS_PROXY = "https://cors.isomorphic-git.org/";

fetch(CORS_PROXY + BMKG_CAP)
  .then(r=>r.text())
  .then(xmlText=>{
    const xml = new DOMParser().parseFromString(xmlText,"text/xml");
    const alerts = xml.getElementsByTagName("alert");

    if(alerts.length===0){
      bmkgAlert.innerHTML="<div class='alert green'>Tidak ada peringatan aktif</div>";
      return;
    }

    let html="";
    for(let i=0;i<alerts.length;i++){
      const info = alerts[i].getElementsByTagName("info")[0];
      if(!info) continue;

      const event = info.getElementsByTagName("event")[0]?.textContent || "";
      const area = info.getElementsByTagName("areaDesc")[0]?.textContent || "";
      const severity = info.getElementsByTagName("severity")[0]?.textContent || "";

      let cls="green";
      if(severity==="Severe") cls="red";
      else if(severity==="Moderate") cls="orange";

      html+=`
        <div class="alert ${cls}">
          <strong>${event}</strong><br>
          <small>${area}</small><br>
          <small>Severity: ${severity}</small>
        </div>
      `;
    }

    bmkgAlert.innerHTML=html;
  })
  .catch(()=>{
    bmkgAlert.innerHTML="<div class='alert orange'>Gagal memuat data BMKG</div>";
  });

// ============================
// AUTO REFRESH (5 MENIT)
// ============================
setTimeout(()=>location.reload(),300000);
</script>

</body>
</html>
