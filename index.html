<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Rekap Kebakaran</title>

<script src="https://www.gstatic.com/charts/loader.js"></script>

<style>
body{
  font-family:Segoe UI,Arial;
  background:#0f1115;
  color:#eaeaea;
  margin:20px;
}
h1{color:#ff6b6b}

select{
  padding:8px 12px;
  border-radius:8px;
  border:none;
  font-size:14px;
  margin-bottom:16px;
}

.card{
  background:#161a24;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.45);
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
th,td{
  border:1px solid #2a2e3b;
  padding:6px;
}
th{
  background:#1c2130;
  color:#ffb3b3;
}
tr:nth-child(even){background:#141824}
</style>
</head>

<body>

<h1>ðŸ”¥ Dashboard Rekap Kebakaran</h1>

<label>Pilih Bulan:</label><br>
<select id="bulan" onchange="loadSheet()"></select>

<div class="card">
  <b>Total Baris:</b> <span id="total">0</span>
</div>

<div class="card">
  <table id="table"></table>
</div>

<script>
google.charts.load('current', {packages:['table']});
google.charts.setOnLoadCallback(init);

const SHEET_ID = "1PU8hf7BEu142XSi0QjCMDgPsD6KaSFET";

const BULAN = [
  "Januari","Februari","Maret","April","Mei","Juni",
  "Juli","Agustus","September","Oktober","November","Desember"
];

function init(){
  const select = document.getElementById("bulan");
  const now = new Date().getMonth();

  BULAN.forEach((b,i)=>{
    const opt=document.createElement("option");
    opt.value=b;
    opt.text=b;
    if(i===now) opt.selected=true;
    select.appendChild(opt);
  });

  loadSheet();
}

function loadSheet(){
  const bulan = document.getElementById("bulan").value;
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(bulan)}&tq=select *`;

  fetch(url)
    .then(res=>res.text())
    .then(text=>{
      if(!text.includes("setResponse")){
        tampilKosong("Sheet tidak ditemukan / belum ada data");
        return;
      }

      const json = JSON.parse(text.substring(47).slice(0,-2));
      const table = json.table;

      if(!table || !table.rows || table.rows.length===0){
        tampilKosong("Tidak ada data di bulan ini");
        return;
      }

      renderTable(table);
    })
    .catch(err=>{
      console.error(err);
      tampilKosong("Gagal memuat data");
    });
}

function tampilKosong(msg){
  document.getElementById("total").innerText = 0;
  document.getElementById("table").innerHTML =
    `<tr><td>${msg}</td></tr>`;
}

function renderTable(table){
  const headers = table.cols.map(c=>c.label || "Kolom");
  const rows = table.rows;

  document.getElementById("total").innerText = rows.length;

  let html="<tr>";
  headers.forEach(h=>html+=`<th>${h}</th>`);
  html+="</tr>";

  rows.forEach(r=>{
    html+="<tr>";
    r.c.forEach(c=>{
      html+=`<td>${c ? c.v : ""}</td>`;
    });
    html+="</tr>";
  });

  document.getElementById("table").innerHTML = html;
}
</script>

</body>
</html>
