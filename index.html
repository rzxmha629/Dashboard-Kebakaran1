<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Command Center Kebencanaan</title>

<style>
:root{
  --bg:#0b0e14;
  --panel:#111726;
  --text:#eaeaea;
  --accent:#6bcfff;
}
.light{
  --bg:#f4f7fb;
  --panel:#ffffff;
  --text:#222;
}
html,body{
  margin:0;height:100%;overflow:hidden;
  background:var(--bg);color:var(--text);
  font-family:Segoe UI,Arial,sans-serif;
}
.wall{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  grid-template-rows:repeat(2,1fr);
  gap:6px;
  padding:6px;
  height:100vh;
}
.panel{
  background:var(--panel);
  border-radius:14px;
  overflow:hidden;
  position:relative;
  box-shadow:0 0 20px rgba(0,0,0,.6);
}
.title{
  position:absolute;
  top:0;left:0;right:0;
  padding:6px 10px;
  font-weight:700;
  font-size:14px;
  background:rgba(0,0,0,.55);
  color:var(--accent);
  z-index:10;
}
.content{
  padding:34px 12px 12px;
  height:100%;
  overflow:auto;
}

/* GEMPA */
.gempa strong{font-size:34px;color:#ff5252}
.gempa div{margin-top:6px;font-size:16px}

/* KEBAKARAN */
.kebakaran{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.card{
  background:linear-gradient(135deg,#ff512f,#dd2476);
  border-radius:12px;
  padding:14px;
  text-align:center;
  font-weight:800;
}
.card span{
  display:block;
  font-size:34px;
}

/* ROTASI */
.focus{
  grid-column:1 / span 3;
  grid-row:1 / span 2;
  z-index:5;
}
</style>
</head>

<body>

<div class="wall">

<!-- GEMPA REALTIME -->
<div class="panel" data-rotate>
  <div class="title">üåç GEMPA TERKINI BMKG (Realtime)</div>
  <div class="content gempa" id="gempa">Memuat...</div>
</div>

<!-- MAGMA -->
<div class="panel">
  <div class="title">üåã MAGMA ESDM</div>
  <iframe id="magma" style="width:100%;height:100%;border:0"></iframe>
</div>

<!-- SIPONGI -->
<div class="panel">
  <div class="title">üî• SIPONGI KARHUTLA</div>
  <iframe id="sipongi" style="width:100%;height:100%;border:0"></iframe>
</div>

<!-- INATEWS -->
<div class="panel">
  <div class="title">üåä InaTEWS Tsunami</div>
  <iframe id="inatews" style="width:100%;height:100%;border:0"></iframe>
</div>

<!-- KEBAKARAN -->
<div class="panel" data-rotate>
  <div class="title">üî• DASHBOARD KEBAKARAN (JAN‚ÄìFEB)</div>
  <div class="content kebakaran">
    <div class="card">JAKBAR<span id="jb">0</span></div>
    <div class="card">JAKPUS<span id="jp">0</span></div>
    <div class="card">JAKSEL<span id="js">0</span></div>
    <div class="card">JAKTIM<span id="jt">0</span></div>
    <div class="card">JAKUT<span id="ju">0</span></div>
    <div class="card">TOTAL<span id="total">0</span></div>
  </div>
</div>

<!-- BNPB -->
<div class="panel">
  <div class="title">üó∫Ô∏è GIS BNPB</div>
  <iframe id="bnpb" style="width:100%;height:100%;border:0"></iframe>
</div>

</div>

<script>
/* ================= MODE SIANG / MALAM ================= */
const h=new Date().getHours();
if(h>=6 && h<18)document.body.classList.add("light");

/* ================= GEMPA REALTIME ================= */
function loadGempa(){
 fetch("https://data.bmkg.go.id/DataMKG/TEWS/autogempa.json?"+Date.now())
 .then(r=>r.json())
 .then(d=>{
   const g=d.Infogempa.gempa;
   gempa.innerHTML=`
    <strong>${g.Magnitude} M</strong>
    <div>${g.Wilayah}</div>
    <div>Kedalaman: ${g.Kedalaman}</div>
    <div>Waktu: ${g.Tanggal} ${g.Jam}</div>
    <div>${g.Potensi}</div>`;
 });
}
loadGempa();
setInterval(loadGempa,15000);

/* ================= KEBAKARAN (JAN + FEB) ================= */
const csvs=[
 "https://docs.google.com/spreadsheets/d/e/2PACX-1vS4JZD0cxRHeBcSJm0KZMXewwX19RWJL1GrNcn2ZQeyeQpVByaiIyt0_FCPEcaRMA/pub?output=csv&gid=1241106342",
 "https://docs.google.com/spreadsheets/d/e/2PACX-1vS4JZD0cxRHeBcSJm0KZMXewwX19RWJL1GrNcn2ZQeyeQpVByaiIyt0_FCPEcaRMA/pub?output=csv&gid=1284284298"
];

function loadKebakaran(){
 let c={jb:0,jp:0,js:0,jt:0,ju:0,total:0};
 Promise.all(csvs.map(u=>fetch(u).then(r=>r.text()))).then(all=>{
  all.join("\n").split("\n").slice(1).forEach(r=>{
   const d=r.split(",");
   if(!d[3]?.toLowerCase().includes("kebakaran"))return;
   c.total++;
   if(d[7]=="Jakarta Barat")c.jb++;
   if(d[7]=="Jakarta Pusat")c.jp++;
   if(d[7]=="Jakarta Selatan")c.js++;
   if(d[7]=="Jakarta Timur")c.jt++;
   if(d[7]=="Jakarta Utara")c.ju++;
  });
  jb.innerText=c.jb; jp.innerText=c.jp; js.innerText=c.js;
  jt.innerText=c.jt; ju.innerText=c.ju; total.innerText=c.total;
 });
}
loadKebakaran();
setInterval(loadKebakaran,180000);

/* ================= SMART IFRAME REFRESH ================= */
function reloadIframe(id,url){
 document.getElementById(id).src=url+"?t="+Date.now();
}
reloadIframe("magma","https://magma.vsi.esdm.go.id/");
reloadIframe("sipongi","https://sipongi.gakkum.kehutanan.go.id/peta");
reloadIframe("inatews","https://inatews.bmkg.go.id/wrs/index.html");
reloadIframe("bnpb","https://gis.bnpb.go.id/");

setInterval(()=>reloadIframe("inatews","https://inatews.bmkg.go.id/wrs/index.html"),60000);
setInterval(()=>reloadIframe("sipongi","https://sipongi.gakkum.kehutanan.go.id/peta"),180000);
setInterval(()=>reloadIframe("magma","https://magma.vsi.esdm.go.id/"),300000);
setInterval(()=>reloadIframe("bnpb","https://gis.bnpb.go.id/"),300000);

/* ================= ROTASI FOKUS ================= */
const rot=document.querySelectorAll("[data-rotate]");
let i=0;
setInterval(()=>{
 rot.forEach(p=>p.classList.remove("focus"));
 rot[i%rot.length].classList.add("focus");
 i++;
},20000);
</script>

</body>
</html>
