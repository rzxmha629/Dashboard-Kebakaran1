<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Rekap Kebakaran</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
  font-family:Segoe UI,Arial;
  background:#0f1115;
  color:#eaeaea;
  margin:20px;
}
h1{color:#ff6b6b}

select{
  padding:8px 12px;
  border-radius:8px;
  border:none;
  margin-bottom:16px;
}

.dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:14px;
  margin-bottom:20px;
}

.card{
  background:#161a24;
  border-radius:14px;
  padding:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.45);
}
.card h2{
  margin:0;
  font-size:13px;
  color:#aaa;
}
.card .count{
  font-size:32px;
  font-weight:800;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
th,td{
  border:1px solid #2a2e3b;
  padding:6px;
}
th{
  background:#1c2130;
  color:#ffb3b3;
}
tr:nth-child(even){background:#141824}
</style>
</head>

<body>

<h1>ðŸ”¥ Dashboard Rekap Kebakaran</h1>

<label>Filter Bulan:</label><br>
<select id="bulan"></select>

<div class="dashboard">
  <div class="card"><h2>Jakarta Barat</h2><div class="count" id="jb">0</div></div>
  <div class="card"><h2>Jakarta Pusat</h2><div class="count" id="jp">0</div></div>
  <div class="card"><h2>Jakarta Selatan</h2><div class="count" id="js">0</div></div>
  <div class="card"><h2>Jakarta Timur</h2><div class="count" id="jt">0</div></div>
  <div class="card"><h2>Jakarta Utara</h2><div class="count" id="ju">0</div></div>
  <div class="card"><h2>Kepulauan Seribu</h2><div class="count" id="ks">0</div></div>
  <div class="card"><h2>Total</h2><div class="count" id="total">0</div></div>
</div>

<table>
<thead id="thead"></thead>
<tbody id="tbody"></tbody>
</table>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vS4JZD0cxRHeBcSJm0KZMXewwX19RWJL1GrNcn2ZQeyeQpVByaiIyt0_FCPEcaRMA/pub?output=csv";

const bulanSelect=document.getElementById("bulan");
const tbody=document.getElementById("tbody");
const thead=document.getElementById("thead");

let rows=[], header=[];

Papa.parse(CSV_URL,{
  download:true,
  skipEmptyLines:true,
  complete:(res)=>{
    header=res.data[0];
    rows=res.data.slice(1);
    buildBulan();
    render();
  }
});

function getMonth(v){
  const d=new Date(v);
  return isNaN(d)?null:d.getMonth();
}

function buildBulan(){
  const set=new Set();

  rows.forEach(r=>{
    const m=getMonth(r[1]); // kolom tanggal
    if(m!==null) set.add(m);
  });

  [...set].sort().forEach(m=>{
    const opt=document.createElement("option");
    opt.value=m;
    opt.text=new Date(2025,m,1)
      .toLocaleString("id-ID",{month:"long"});
    bulanSelect.appendChild(opt);
  });

  bulanSelect.value=new Date().getMonth();
  bulanSelect.onchange=render;
}

function render(){
  tbody.innerHTML="";
  thead.innerHTML="<tr>"+header.map(h=>`<th>${h}</th>`).join("")+"</tr>";

  let count={
    "Jakarta Barat":0,
    "Jakarta Pusat":0,
    "Jakarta Selatan":0,
    "Jakarta Timur":0,
    "Jakarta Utara":0,
    "Kepulauan Seribu":0
  };

  let total=0;
  const bulan=Number(bulanSelect.value);

  rows.forEach(r=>{
    if(getMonth(r[1])!==bulan) return;

    const jenis=(r[3]||"").toLowerCase();
    if(!jenis.includes("kebakaran")) return;

    const kota=r[7] || "";

    if(count[kota]!==undefined) count[kota]++;

    const tr=document.createElement("tr");
    r.forEach(c=>tr.innerHTML+=`<td>${c || ""}</td>`);
    tbody.appendChild(tr);

    total++;
  });

  document.getElementById("jb").innerText=count["Jakarta Barat"];
  document.getElementById("jp").innerText=count["Jakarta Pusat"];
  document.getElementById("js").innerText=count["Jakarta Selatan"];
  document.getElementById("jt").innerText=count["Jakarta Timur"];
  document.getElementById("ju").innerText=count["Jakarta Utara"];
  document.getElementById("ks").innerText=count["Kepulauan Seribu"];
  document.getElementById("total").innerText=total;
}
</script>

</body>
</html>
